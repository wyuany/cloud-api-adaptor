#
# (C) Copyright IBM Corp. 2023.
# SPDX-License-Identifier: Apache-2.0
#

---
# - name: "Add gpg key "
#   apt_key:
#     url: https://packages.cloud.google.com/apt/doc/apt-key.gpg
#     state: present
    

# - name: "Add kubernetes source list "
#   apt_repository:
#     repo: "deb https://apt.kubernetes.io/ kubernetes-xenial main"
#     state: present
#     filename: "kubernetes"

- name: "Download the public signing key for the Kubernetes package repositories"
  command: curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.29/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg

- name: "Add Kubernetes repository definition"
  command: echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.29/deb/ /" | sudo tee /etc/apt/sources.list.d/kubernetes.list

- name: "Update the apt package index"
  apt:
    update_cache: yes

- name: "Install kubelet, kubeadm, kubectl "
  apt:
    update_cache: true
    name: ['kubelet', 'kubeadm', 'kubectl', 'kubernetes-cni', 'cri-tools']
    state: present
